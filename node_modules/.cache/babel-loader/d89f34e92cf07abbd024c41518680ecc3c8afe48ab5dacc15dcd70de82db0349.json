{"ast":null,"code":"import React,{useState}from'react';import{toast}from'react-hot-toast';import{PlusIcon,TrashIcon}from'@heroicons/react/24/outline';import api from'../../services/api';import{getMoscowTimeForInput,isFutureMoscowTime}from'../../utils/dateUtils';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CreateRaffleForm=_ref=>{let{onSuccess}=_ref;const[formData,setFormData]=useState({title:'',description:'',photo_url:'',channels:[''],post_channels:[''],// НОВОЕ: каналы для публикации\nprizes:{1:''},end_date:'',draw_delay_minutes:5,wheel_speed:'fast'// НОВОЕ: скорость колеса\n});const[uploading,setUploading]=useState(false);const[submitting,setSubmitting]=useState(false);const handleInputChange=e=>{const{name,value}=e.target;setFormData(prev=>({...prev,[name]:value}));};const handleChannelChange=(index,value)=>{const newChannels=[...formData.channels];newChannels[index]=value;setFormData(prev=>({...prev,channels:newChannels}));};const addChannel=()=>{setFormData(prev=>({...prev,channels:[...prev.channels,'']}));};const removeChannel=index=>{const newChannels=formData.channels.filter((_,i)=>i!==index);setFormData(prev=>({...prev,channels:newChannels}));};// НОВЫЕ МЕТОДЫ ДЛЯ КАНАЛОВ ПУБЛИКАЦИИ\nconst handlePostChannelChange=(index,value)=>{const newChannels=[...formData.post_channels];newChannels[index]=value;setFormData(prev=>({...prev,post_channels:newChannels}));};const addPostChannel=()=>{setFormData(prev=>({...prev,post_channels:[...prev.post_channels,'']}));};const removePostChannel=index=>{const newChannels=formData.post_channels.filter((_,i)=>i!==index);setFormData(prev=>({...prev,post_channels:newChannels}));};const handlePrizeChange=(position,value)=>{setFormData(prev=>({...prev,prizes:{...prev.prizes,[position]:value}}));};const addPrize=()=>{const positions=Object.keys(formData.prizes).map(Number);const nextPosition=Math.max(...positions)+1;setFormData(prev=>({...prev,prizes:{...prev.prizes,[nextPosition]:''}}));};const removePrize=position=>{const newPrizes={...formData.prizes};delete newPrizes[position];setFormData(prev=>({...prev,prizes:newPrizes}));};const handleImageUpload=async e=>{const file=e.target.files[0];if(!file)return;if(!file.type.startsWith('image/')){toast.error('Пожалуйста, выберите изображение');return;}setUploading(true);const formData=new FormData();formData.append('file',file);try{const response=await api.post('/admin/upload-image',formData,{headers:{'Content-Type':'multipart/form-data'}});setFormData(prev=>({...prev,photo_url:response.data.url}));toast.success('Изображение загружено');}catch(error){toast.error('Ошибка загрузки изображения');}finally{setUploading(false);}};const handleSubmit=async e=>{e.preventDefault();// Validation\nif(!formData.title||!formData.description){toast.error('Заполните все обязательные поля');return;}const validChannels=formData.channels.filter(ch=>ch.trim());const validPostChannels=formData.post_channels.filter(ch=>ch.trim());// ДОБАВЛЕНО\nconst validPrizes=Object.fromEntries(Object.entries(formData.prizes).filter(_ref2=>{let[_,prize]=_ref2;return prize.trim();}));if(Object.keys(validPrizes).length===0){toast.error('Добавьте хотя бы один приз');return;}setSubmitting(true);try{const payload={...formData,channels:validChannels,post_channels:validPostChannels,// ДОБАВЛЕНО\nprizes:validPrizes,end_date:new Date(formData.end_date).toISOString()};await api.post('/admin/raffles',payload);toast.success('Розыгрыш успешно создан!');// Reset form\nsetFormData({title:'',description:'',photo_url:'',channels:[''],post_channels:[''],// ДОБАВЛЕНО\nprizes:{1:''},end_date:'',draw_delay_minutes:5,wheel_speed:'fast'// ДОБАВЛЕНО\n});if(onSuccess){onSuccess();}}catch(error){toast.error('Ошибка создания розыгрыша');}finally{setSubmitting(false);}};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"bg-white rounded-lg shadow-lg p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-6\",children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u043D\\u043E\\u0432\\u044B\\u0439 \\u0440\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0440\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448\\u0430 *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",value:formData.title,onChange:handleInputChange,className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"\\u041E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435 *\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"description\",value:formData.description,onChange:handleInputChange,rows:\"4\",className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"\\u0418\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleImageUpload,disabled:uploading,className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\"}),uploading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mt-1\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"}),formData.photo_url&&/*#__PURE__*/_jsx(\"img\",{src:formData.photo_url,alt:\"Preview\",className:\"mt-2 h-32 object-cover rounded\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"\\u041A\\u0430\\u043D\\u0430\\u043B\\u044B \\u0434\\u043B\\u044F \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u043A\\u0438\"}),formData.channels.map((channel,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex mb-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:channel,onChange:e=>handleChannelChange(index,e.target.value),placeholder:\"@channel_username\",className:\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>removeChannel(index),className:\"ml-2 text-red-600 hover:text-red-800\",children:/*#__PURE__*/_jsx(TrashIcon,{className:\"h-5 w-5\"})})]},index)),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:addChannel,className:\"mt-2 flex items-center text-blue-600 hover:text-blue-800\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-5 w-5 mr-1\"}),\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043A\\u0430\\u043D\\u0430\\u043B\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:[\"\\u041E\\u043F\\u0443\\u0431\\u043B\\u0438\\u043A\\u043E\\u0432\\u0430\\u0442\\u044C \\u0440\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448 \\u0432 \\u043A\\u0430\\u043D\\u0430\\u043B\\u0430\\u0445\",/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-normal text-gray-500 ml-2\",children:\"(\\u0431\\u043E\\u0442 \\u0434\\u043E\\u043B\\u0436\\u0435\\u043D \\u0431\\u044B\\u0442\\u044C \\u0430\\u0434\\u043C\\u0438\\u043D\\u0438\\u0441\\u0442\\u0440\\u0430\\u0442\\u043E\\u0440\\u043E\\u043C)\"})]}),formData.post_channels.map((channel,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex mb-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:channel,onChange:e=>handlePostChannelChange(index,e.target.value),placeholder:\"@channel_username\",className:\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>removePostChannel(index),className:\"ml-2 text-red-600 hover:text-red-800\",children:/*#__PURE__*/_jsx(TrashIcon,{className:\"h-5 w-5\"})})]},`post_${index}`)),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:addPostChannel,className:\"mt-2 flex items-center text-blue-600 hover:text-blue-800\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-5 w-5 mr-1\"}),\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043A\\u0430\\u043D\\u0430\\u043B \\u0434\\u043B\\u044F \\u043F\\u0443\\u0431\\u043B\\u0438\\u043A\\u0430\\u0446\\u0438\\u0438\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"\\u041F\\u0440\\u0438\\u0437\\u044B *\"}),Object.entries(formData.prizes).map(_ref3=>{let[position,prize]=_ref3;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex mb-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-lg\",children:[position,\" \\u043C\\u0435\\u0441\\u0442\\u043E\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:prize,onChange:e=>handlePrizeChange(position,e.target.value),placeholder:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u043F\\u0440\\u0438\\u0437\\u0430\",className:\"flex-1 px-3 py-2 border border-gray-300 rounded-r-lg focus:outline-none focus:border-blue-500\"}),Object.keys(formData.prizes).length>1&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>removePrize(position),className:\"ml-2 text-red-600 hover:text-red-800\",children:/*#__PURE__*/_jsx(TrashIcon,{className:\"h-5 w-5\"})})]},position);}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:addPrize,className:\"mt-2 flex items-center text-blue-600 hover:text-blue-800\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-5 w-5 mr-1\"}),\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043F\\u0440\\u0438\\u0437\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"\\u0414\\u0430\\u0442\\u0430 \\u0438 \\u0432\\u0440\\u0435\\u043C\\u044F \\u043E\\u043A\\u043E\\u043D\\u0447\\u0430\\u043D\\u0438\\u044F *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"datetime-local\",name:\"end_date\",value:formData.end_date,onChange:handleInputChange,className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"\\u0417\\u0430\\u0434\\u0435\\u0440\\u0436\\u043A\\u0430 \\u043F\\u0435\\u0440\\u0435\\u0434 \\u043D\\u0430\\u0447\\u0430\\u043B\\u043E\\u043C \\u0440\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448\\u0430 (\\u043C\\u0438\\u043D\\u0443\\u0442)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"draw_delay_minutes\",value:formData.draw_delay_minutes,onChange:handleInputChange,min:\"1\",max:\"60\",className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",children:\"\\u0421\\u043A\\u043E\\u0440\\u043E\\u0441\\u0442\\u044C \\u0432\\u0440\\u0430\\u0449\\u0435\\u043D\\u0438\\u044F \\u043A\\u043E\\u043B\\u0435\\u0441\\u0430\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"wheel_speed\",value:formData.wheel_speed,onChange:handleInputChange,className:\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"fast\",children:\"\\u0411\\u044B\\u0441\\u0442\\u0440\\u043E\"}),/*#__PURE__*/_jsx(\"option\",{value:\"medium\",children:\"\\u0421\\u0440\\u0435\\u0434\\u043D\\u044F\\u044F (\\u0432 3 \\u0440\\u0430\\u0437\\u0430 \\u043C\\u0435\\u0434\\u043B\\u0435\\u043D\\u043D\\u0435\\u0435)\"}),/*#__PURE__*/_jsx(\"option\",{value:\"slow\",children:\"\\u041C\\u0435\\u0434\\u043B\\u0435\\u043D\\u043D\\u043E (\\u0432 4.5 \\u0440\\u0430\\u0437\\u0430 \\u043C\\u0435\\u0434\\u043B\\u0435\\u043D\\u043D\\u0435\\u0435)\"})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:submitting,className:\"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed\",children:submitting?'Создание...':'Создать розыгрыш'})]});};export default CreateRaffleForm;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}