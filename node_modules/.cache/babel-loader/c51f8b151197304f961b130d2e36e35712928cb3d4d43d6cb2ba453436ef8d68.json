{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate}from'react-router-dom';import{CheckIcon,XMarkIcon,ArrowLeftIcon}from'@heroicons/react/24/outline';import{toast}from'react-hot-toast';import WebApp from'@twa-dev/sdk';import api from'../services/api';import Countdown from'react-countdown';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RafflePage=()=>{const{id}=useParams();const navigate=useNavigate();const[raffle,setRaffle]=useState(null);const[loading,setLoading]=useState(true);const[participating,setParticipating]=useState(false);useEffect(()=>{loadRaffle();},[id]);const loadRaffle=async()=>{try{const response=await api.get(`/raffles/${id}`);setRaffle(response.data);// Check participation status\nconst participationRes=await api.get(`/raffles/${id}/check-participation`);setParticipating(participationRes.data.is_participating);}catch(error){toast.error('Ошибка загрузки розыгрыша');navigate('/');}finally{setLoading(false);}};const handleParticipate=async()=>{try{var _WebApp$initDataUnsaf;// Check username\nconst user=(_WebApp$initDataUnsaf=WebApp.initDataUnsafe)===null||_WebApp$initDataUnsaf===void 0?void 0:_WebApp$initDataUnsaf.user;if(!(user!==null&&user!==void 0&&user.username)){toast.error('Для участия необходимо установить имя пользователя (@username) в настройках Telegram');return;}// Participate (server will check channels)\nconst response=await api.post(`/raffles/${id}/participate`);if(response.data.status==='success'){toast.success('Вы успешно зарегистрированы!');setParticipating(true);// Show success animation\nWebApp.HapticFeedback.notificationOccurred('success');// Reload raffle data\nawait loadRaffle();}}catch(error){var _error$response,_error$response$data;if((_error$response=error.response)!==null&&_error$response!==void 0&&(_error$response$data=_error$response.data)!==null&&_error$response$data!==void 0&&_error$response$data.detail){toast.error(error.response.data.detail);}else{toast.error('Ошибка при регистрации');}}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-screen\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"})});}if(!raffle){return null;}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sticky top-0 z-50 bg-white shadow-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4 py-3 flex items-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),className:\"p-2 rounded-lg hover:bg-gray-100 transition-colors\",\"aria-label\":\"\\u041D\\u0430\\u0437\\u0430\\u0434\",children:/*#__PURE__*/_jsx(ArrowLeftIcon,{className:\"h-5 w-5 text-gray-600\"})}),/*#__PURE__*/_jsx(\"h1\",{className:\"ml-3 text-lg font-semibold text-gray-800 truncate\",children:raffle.title})]})}),raffle.photo_url&&/*#__PURE__*/_jsx(\"div\",{className:\"h-64 overflow-hidden\",children:/*#__PURE__*/_jsx(\"img\",{src:raffle.photo_url,alt:raffle.title,className:\"w-full h-full object-cover\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4 py-6\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-800 mb-4\",children:raffle.title}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"\\u041E\\u043F\\u0438\\u0441\\u0430\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 whitespace-pre-wrap\",children:raffle.description})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"\\uD83C\\uDFC6 \\u041F\\u0440\\u0438\\u0437\\u044B\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:Object.entries(raffle.prizes).map(_ref=>{let[position,prize]=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl\",children:[position==='1'&&'🥇',position==='2'&&'🥈',position==='3'&&'🥉',parseInt(position)>3&&'🏅']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-semibold\",children:[position,\" \\u043C\\u0435\\u0441\\u0442\\u043E\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700\",children:prize})]})]},position);})})]}),raffle.channels.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"\\uD83D\\uDCCB \\u0423\\u0441\\u043B\\u043E\\u0432\\u0438\\u044F \\u0443\\u0447\\u0430\\u0441\\u0442\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 mb-4\",children:\"\\u0414\\u043B\\u044F \\u0443\\u0447\\u0430\\u0441\\u0442\\u0438\\u044F \\u0432 \\u0440\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448\\u0435 \\u043D\\u0435\\u043E\\u0431\\u0445\\u043E\\u0434\\u0438\\u043C\\u043E \\u0431\\u044B\\u0442\\u044C \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u0430\\u043D\\u043D\\u044B\\u043C \\u043D\\u0430 \\u0441\\u043B\\u0435\\u0434\\u0443\\u044E\\u0449\\u0438\\u0435 \\u043A\\u0430\\u043D\\u0430\\u043B\\u044B:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:raffle.channels.map(channel=>/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\",children:/*#__PURE__*/_jsx(\"a\",{href:`https://t.me/${channel.replace('@','')}`,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600 hover:underline font-medium\",children:channel})},channel))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"\\u23F0 \\u0414\\u043E \\u043E\\u043A\\u043E\\u043D\\u0447\\u0430\\u043D\\u0438\\u044F \\u0440\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448\\u0430\"}),/*#__PURE__*/_jsx(Countdown,{date:new Date(raffle.end_date),renderer:_ref2=>{let{days,hours,minutes,seconds,completed}=_ref2;if(completed){return/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl text-red-600 font-bold\",children:\"\\u0420\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448 \\u0437\\u0430\\u0432\\u0435\\u0440\\u0448\\u0435\\u043D\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-blue-600\",children:days}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"\\u0434\\u043D\\u0435\\u0439\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-blue-600\",children:hours}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"\\u0447\\u0430\\u0441\\u043E\\u0432\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-blue-600\",children:minutes}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"\\u043C\\u0438\\u043D\\u0443\\u0442\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-3xl font-bold text-blue-600\",children:seconds}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"\\u0441\\u0435\\u043A\\u0443\\u043D\\u0434\"})]})]});}})]}),!participating?/*#__PURE__*/_jsx(\"button\",{onClick:handleParticipate,className:\"w-full bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-blue-700 transition-colors duration-200\",children:\"\\u0423\\u0447\\u0430\\u0441\\u0442\\u0432\\u043E\\u0432\\u0430\\u0442\\u044C\"}):/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-green-100 text-green-700 py-4 px-6 rounded-lg font-semibold text-lg text-center\",children:\"\\u2705 \\u0412\\u044B \\u0443\\u0436\\u0435 \\u0443\\u0447\\u0430\\u0441\\u0442\\u0432\\u0443\\u0435\\u0442\\u0435 \\u0432 \\u044D\\u0442\\u043E\\u043C \\u0440\\u043E\\u0437\\u044B\\u0433\\u0440\\u044B\\u0448\\u0435\"})]})]});};export default RafflePage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}